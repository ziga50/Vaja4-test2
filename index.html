<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- leaflet css -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
      integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
      crossorigin=""
    />

    <!-- leaflet js -->
    <script
      src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
      integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
      crossorigin=""
    ></script>

    <title>NEP_RPE_OBCINE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <style>
      body { margin: 0; padding: 0; }
      #map { height: 100vh; width: 100%; }
    </style>
  </head>

  <body>
    <div id="map"></div>

    <script>
      // 1) osnovna karta
      var map = L.map("map").setView([46.15, 14.99], 8);

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19,
        attribution:
          '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
      }).addTo(map);

      // 2) helper za stil
      function styleFeature(feature) {
        return {
          color: "#111",
          weight: 1,
          fillOpacity: 0.35,
        };
      }

      // 3) naloži geojson iz ISTE mape kot index.html
      fetch("./obcine_wgs.json")
        .then((response) => {
          if (!response.ok) throw new Error("HTTP " + response.status);
          return response.json();
        })
        .then((data) => {
          // debug: poglej v konzoli, ali se je sploh naložilo
          console.log("Loaded GeoJSON:", data);

          var layer = L.geoJSON(data, {
            style: styleFeature,
            onEachFeature: function (feature, lyr) {
              // poskusi najti neko smiselno ime atributa
              var props = feature.properties || {};
              var title =
                props.NAZIV ||
                props.IME_OBCINA ||
                props.NAME ||
                props.naziv ||
                "Občina";

              // pokaži vse atribute v popupu
              var rows = Object.keys(props)
                .map((k) => `<tr><td><b>${k}</b></td><td>${props[k]}</td></tr>`)
                .join("");

              lyr.bindPopup(`<h3>${title}</h3><table>${rows}</table>`);
            },
          }).addTo(map);

          // 4) zoom na sloj (da ne bo “prazno”)
          try {
            map.fitBounds(layer.getBounds());
          } catch (e) {
            console.warn("fitBounds failed (maybe invalid coords/CRS).", e);
          }
        })
        .catch((err) => {
          console.error("Failed to load GeoJSON:", err);
          alert("Ne morem naložiti NEP_RPE_OBCINE.json. Odpri Console (F12).");
        });
    </script>
  </body>
</html>
